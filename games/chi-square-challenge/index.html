<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi-Square Challenge - Games4Stats</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../games/variance-voyager/styles.css">
    <style>
        /* Mobile-first responsive styles */
        .contingency-table {
            display: grid;
            gap: 2px;
            background: rgba(255, 255, 255, 0.1);
            padding: 2px;
            border-radius: 12px;
            margin: 1rem 0;
            width: 100%;
            overflow-x: auto;
        }

        .table-cell {
            background: rgba(0, 0, 0, 0.4);
            padding: 0.75rem 0.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            position: relative;
            font-size: 0.85rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .table-cell.header {
            background: rgba(236, 72, 153, 0.2);
            font-weight: 600;
            font-size: 0.8rem;
        }

        .table-cell.data {
            background: rgba(255, 255, 255, 0.05);
        }

        .table-cell.total {
            background: rgba(99, 102, 241, 0.2);
            font-weight: 600;
        }

        .observed-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
        }

        .expected-value {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }

        .residual-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .residual-high { background: #22c55e; }
        .residual-medium { background: #f59e0b; }
        .residual-low { background: #ef4444; }

        .chi-square-display {
            font-family: 'Space Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin: 0.75rem 0;
        }

        .chi-square-display.significant {
            color: #22c55e;
        }

        .chi-square-display.not-significant {
            color: #ef4444;
        }

        .cell-input {
            width: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            text-align: center;
            padding: 0.4rem;
            font-family: inherit;
        }

        .cell-input:focus {
            outline: none;
            border-color: #ec4899;
            background: rgba(236, 72, 153, 0.1);
        }

        .scenario-text {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Hero card responsiveness */
        .hero-card {
            max-width: 90vw;
            padding: 1.5rem;
            margin: 1rem;
        }

        @media (min-width: 768px) {
            .hero-card {
                max-width: 560px;
                padding: 2rem;
            }
        }

        /* Ensure screens handle overflow properly */
        .screen {
            overflow-y: auto;
            padding: 1rem;
        }

        @media (min-width: 768px) {
            .screen {
                padding: 2rem;
            }
        }

        .decision-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .decision-btn {
            flex: 1;
            padding: 0.875rem 0.5rem;
            border-radius: 12px;
            border: 2px solid;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 60px;
            touch-action: manipulation;
        }

        .decision-btn.independent {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #ef4444;
        }

        .decision-btn.associated {
            background: rgba(34, 197, 94, 0.1);
            border-color: #22c55e;
            color: #22c55e;
        }

        .decision-btn:hover {
            transform: scale(1.02);
            filter: brightness(1.2);
        }

        .decision-btn small {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .heatmap-legend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: #94a3b8;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-gradient {
            width: 80px;
            height: 8px;
            background: linear-gradient(to right, rgba(34, 197, 94, 0.3), rgba(245, 158, 11, 0.5), rgba(239, 68, 68, 0.7));
            border-radius: 5px;
        }

        /* Game screen layout fixes */
        #game-screen {
            overflow-y: auto;
            padding: 1rem;
        }

        .game-main {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 100%;
        }

        .canvas-container {
            width: 100%;
            max-width: 100%;
            padding: 1rem;
        }

        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        /* Tablet and up */
        @media (min-width: 768px) {
            .game-main {
                flex-direction: row;
                max-width: 1200px;
            }

            .canvas-container {
                flex: 1;
                max-width: 600px;
            }

            .stats-panel {
                width: 320px;
                flex-shrink: 0;
            }

            .table-cell {
                padding: 1rem;
                min-height: 80px;
                font-size: 1rem;
            }

            .table-cell.header {
                font-size: 0.9rem;
            }

            .observed-value {
                font-size: 1.5rem;
            }

            .expected-value {
                font-size: 0.85rem;
            }

            .chi-square-display {
                font-size: 2.5rem;
            }

            .decision-btn {
                padding: 1rem;
                font-size: 1rem;
            }

            .scenario-text {
                font-size: 0.95rem;
            }
        }

        /* Large screens */
        @media (min-width: 1024px) {
            .game-main {
                gap: 2rem;
            }

            .stats-panel {
                width: 340px;
            }
        }

        /* Small mobile adjustments */
        @media (max-width: 400px) {
            .table-cell {
                padding: 0.5rem 0.25rem;
                min-height: 50px;
                font-size: 0.75rem;
            }

            .observed-value {
                font-size: 1.1rem;
            }

            .expected-value {
                font-size: 0.7rem;
            }

            .chi-square-display {
                font-size: 1.75rem;
            }

            .decision-btn {
                font-size: 0.85rem;
                padding: 0.75rem 0.25rem;
            }

            .scenario-text {
                font-size: 0.85rem;
                padding: 0.75rem;
            }
        }

        /* Ensure proper viewport handling */
        html {
            overflow-x: hidden;
        }

        body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        /* Prevent horizontal scroll on game screen */
        #game-screen.game-screen {
            max-width: 100vw;
            overflow-x: hidden;
        }
    </style>
</head>

<body>
    <div class="background-effects">
        <div class="gradient-orb orb-1" style="background: rgba(236, 72, 153, 0.4)"></div>
        <div class="gradient-orb orb-2" style="background: rgba(168, 85, 247, 0.4)"></div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="screen active">
        <div class="glass-card hero-card">
            <h1 class="game-title">Chi-Square Challenge</h1>
            <p class="game-subtitle">Test for Associations in Categorical Data</p>

            <div class="intro-text">
                <p>Are two categorical variables related, or just coincidental?</p>
                <p class="hint-text">Your mission: Analyze contingency tables to determine if there's a <strong>significant association</strong> between variables.</p>
            </div>

            <button id="start-btn" class="primary-btn">
                <span>Start Challenge</span>
            </button>
            <br>
            <a href="../../index.html" style="color: rgba(255,255,255,0.5); text-decoration: none; font-size: 0.9rem;">‚Üê
                Back to Hub</a>
        </div>
    </div>

        <!-- Game Screen -->
    <div id="game-screen" class="screen game-screen">
        <header class="game-header" style="width: 100%; max-width: 1200px; margin-bottom: 1rem; display: flex; justify-content: center;">
            <div class="level-indicator glass-pill">
                <span class="level-label">Challenge</span>
                <span id="level-number" class="level-num">1</span>
                <span id="level-name" class="level-name">Independence Test</span>
            </div>
        </header>

        <main class="game-main">
            <div class="canvas-container glass-card">
                <div class="scenario-text" id="scenario-text">
                    A study examines whether a new teaching method improves student pass rates...
                </div>

                <div id="contingency-table" class="contingency-table" style="grid-template-columns: repeat(3, 1fr);">
                    <!-- Table cells will be generated by JS -->
                </div>

                <div class="heatmap-legend">
                    <span>Low œá¬≤ contribution</span>
                    <div class="legend-gradient"></div>
                    <span>High œá¬≤ contribution</span>
                </div>

                <div class="chi-square-display" id="chi-square-display">
                    œá¬≤ = 0.00
                </div>

                <div style="text-align: center; font-size: 0.9rem; color: #94a3b8;" id="p-value-display">
                    p-value > 0.05 (Not Significant)
                </div>
            </div>

            <aside class="stats-panel">
                <div class="stat-card glass-card">
                    <h3>Your Decision</h3>
                    <p style="margin-bottom: 1rem; font-size: 0.9rem; color: #cbd5e1;">
                        Based on the chi-square test, are these variables:
                    </p>

                    <div class="decision-buttons">
                        <button id="btn-independent" class="decision-btn independent">
                            Independent<br>
                            <small>(No association)</small>
                        </button>
                        <button id="btn-associated" class="decision-btn associated">
                            Associated<br>
                            <small>(Significant link)</small>
                        </button>
                    </div>
                </div>

                <div class="stat-card glass-card">
                    <h3>Understanding</h3>
                    <div id="understanding-text" style="font-size: 0.9rem; line-height: 1.5; color: #cbd5e1;">
                        <strong>Observed:</strong> Actual counts from your data<br>
                        <strong>Expected:</strong> Counts if variables were independent<br>
                        <strong>œá¬≤:</strong> Sum of (O-E)¬≤/E - measures deviation
                    </div>
                </div>

                <button id="confirm-btn" class="primary-btn" disabled>
                    <span>Submit Answer</span>
                </button>
            </aside>
        </main>
    </div>

    <!-- Complete Screen -->
    <div id="complete-screen" class="screen">
        <div class="glass-card complete-card">
            <h2 id="complete-title">Correct! üéâ</h2>
            <div class="insight-box">
                <h4>üìö Research Insight</h4>
                <p id="insight-text">The chi-square statistic measures how much observed counts deviate from expected counts under independence.</p>
            </div>
            <button id="next-level-btn" class="primary-btn">
                <span>Next Challenge</span>
            </button>
        </div>
    </div>

    <script src="game.js"></script>
</body>

</html>
